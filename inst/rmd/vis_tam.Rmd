---
title: "Tiny Assessment Model Dashboard"
output:
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bg: "#FFFFFF"   
      fg: "#000000"          
      primary: "#003e56"     
      secondary: "#fec124"   
      navbar-bg: "#007187"  
      navbar-fg: "#FFFFFF"
      link-color: "#028f8d"
      base_font:
        google: Poppins 
      heading_font:
        google: Poppins
      code_font:
        google:
          family: JetBrains Mono
          local: false
---


```{r setup, echo=FALSE}
library(tinyAM)
library(plotly)
knitr::opts_chunk$set(cache = FALSE)
```


```{r data, include=FALSE}

tabs <- tidy_tam(model_list = fits, label = "model", label_type = "factor", interval = interval)
obs_pred <- tabs$obs_pred
pop <- tabs$pop
fixed_par <- tabs$fixed_par
random_par <- tabs$random_par

```


```{r helpers, include = FALSE}

cols <- tam_pal(length(fits))

make_resid_plots <- function(d) {
  list(bubbles = plot_bubbles(d, frame = ~model, colors = tam_pal(2)),
       year = plot_resid(d, x = ~year, xlab = "Year", frame = ~model, color = ~model, colors = cols),
       age = plot_resid(d, x = ~age, xlab = "Age", frame = ~model, color = ~model, colors = cols),
       cohort = plot_resid(d, x = ~(year - age), xlab = "Cohort", frame = ~model, color = ~model, colors = cols),
       expected = plot_resid(d, x = ~log(pred), xlab = "Expected", frame = ~model, color = ~model, colors = cols))
}

table_link <- function(x, table_name = NULL, download_text = "Download table") {
  d <- tempdir()
  f <- file.path(d, paste0(table_name, ".csv"))
  write.csv(x, file = f)
  xfun::embed_file(f, text = "Download table")
}

```

```{r fishery, child = "fishery.Rmd"}
```

```{r surveys, child = "surveys.Rmd"}
```

```{r trends, child = "trends.Rmd"}
```

```{r parameters, child = "parameters.Rmd"}
```

```{r tables, child = "tables.Rmd"}
```







